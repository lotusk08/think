<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Think tree</title>
    <meta charset="utf-8" />
    <meta
      name="description"
      content="Thinking tool to organize ideas, brainstorm, and visualize concepts effortlessly"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="%sveltekit.assets%/favicon.ico" />
    <link rel="manifest" href="/manifest.json" />
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/icon-180x180.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icon-180x180.png" />
    <link rel="apple-touch-icon-precomposed" href="/icon-180x180.png" />
    <!-- Prevent flash of incorrect theme -->
    <script>
      (function () {
        try {
          function setTheme(isDark) {
            const newTheme = isDark ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            
            // Update theme-color meta tags for browser UI
            const themeColor = isDark ? '#1a1a1a' : '#FCFCF9';
            const metaTags = document.querySelectorAll('meta[name="theme-color"]');
            metaTags.forEach(tag => {
              if ((!isDark && tag.media === '(prefers-color-scheme: light)') ||
                  (isDark && tag.media === '(prefers-color-scheme: dark)')) {
                tag.setAttribute('content', themeColor);
              }
            });
            
            if (window.themeStore && typeof window.themeStore.set === 'function') {
              window.themeStore.set(newTheme);
            }
          }

          // Get saved theme or use system preference
          const savedTheme = localStorage.getItem('theme');
          const systemDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
          
          if (savedTheme) {
            setTheme(savedTheme === 'dark');
          } else {
            setTheme(systemDarkMode.matches);
          }

          // Handle system theme changes
          function handleThemeChange(e) {
            if (!localStorage.getItem('theme')) {
              setTheme(e.matches);
            }
          }

          // Safari might not support removeEventListener for matchMedia
          try {
            systemDarkMode.removeEventListener('change', handleThemeChange);
          } catch (e) {
            console.warn('Could not remove media query listener');
          }

          // Try modern event listener first
          try {
            systemDarkMode.addEventListener('change', handleThemeChange);
          } catch (e) {
            // Fallback for older browsers (especially Safari)
            systemDarkMode.addListener(handleThemeChange);
          }

          // Force an initial check
          handleThemeChange(systemDarkMode);
        } catch (e) {
          console.warn('Theme initialization failed:', e);
        }
      })();
    </script>
    <!-- Optional: Preload icons for better performance -->
    <link
      rel="icon"
      href="/icon-512x512.png"
      sizes="512x512"
      type="image/png"
    />
    <link rel="apple-touch-icon" href="/icon-180x180.png" />
    <!-- Theme color for browser UI -->
    <meta
      name="theme-color"
      content="#FCFCF9"
      media="(prefers-color-scheme: light)"
    />
    <meta
      name="theme-color"
      content="#1a1a1a"
      media="(prefers-color-scheme: dark)"
    />
    <meta name="theme-color" content="#FCFCF9" />
    <!-- Open Graph for social sharing -->
    <meta property="og:title" content="Think tree" />
    <meta
      property="og:description"
      content="Thinking tool to organize ideas, brainstorm, and visualize concepts effortlessly"
    />
    <meta property="og:image" content="/icon-512x512.png" />
    <meta property="og:url" content="https://think.stevehoang.com" />
    <meta property="og:type" content="website" />
    <!-- Preconnect to Font Awesome CDN -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin />
    <!-- Font Awesome CDN -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      :root {
        --bg-color: #fcfcf9;
        --text-color: #494949;
        --border-color: #e0e0e0;
        --menu-bg: rgba(255, 255, 255, 0.1);
        --editor-bg: rgba(255, 255, 255, 0.02);
        --icon-color: #757575;
        --icon-hover: #007bff;
        --link-color: #0056b2;
      }

      [data-theme="dark"] {
        --bg-color: #1a1a1a;
        --text-color: #e7e7e7;
        --border-color: #404040;
        --menu-bg: rgba(0, 0, 0, 0.2);
        --editor-bg: rgba(0, 0, 0, 0.1);
        --icon-color: #9e9e9e;
        --icon-hover: #ff7f50;
        --link-color: #c67839;
      }

      body {
        background-color: var(--bg-color);
        color: var(--text-color);
        transition: background-color 0.2s ease, color 0.2s ease;
      }

      /* Add transitions for all themed elements */
      * {
        transition: background-color 0.2s ease, color 0.2s ease,
          border-color 0.2s ease, box-shadow 0.2s ease;
      }
    </style>
    %sveltekit.head%
  </head>
  <body>
    <div style="display: contents">%sveltekit.body%</div>
  </body>
</html>
